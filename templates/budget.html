<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ×ª×§×¦×™×‘</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Navigation Menu -->
        <nav style="background: rgba(255,255,255,0.95); padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            <a href="/" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; transition: all 0.3s;">ğŸ  ×“×£ ×”×‘×™×ª</a>
            <span style="color: #ccc;">|</span>
            <a href="/tasks" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; transition: all 0.3s;">ğŸ“‹ ××©×™××•×ª</a>
            <span style="color: #ccc;">|</span>
            <a href="/budget" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; font-weight: bold; transition: all 0.3s;">ğŸ’° ×”×•×¦××•×ª</a>
            <span style="color: #ccc;">|</span>
            <a href="/suppliers" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; transition: all 0.3s;">ğŸ¢ ×¡×¤×§×™×</a>
            <span style="color: #ccc;">|</span>
            <a href="/events" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; transition: all 0.3s;">ğŸ“… ××™×¨×•×¢×™×</a>
            <span style="color: #ccc;">|</span>
            <a href="/settings" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; transition: all 0.3s;">âš™ï¸ ×”×’×“×¨×•×ª</a>
            <span style="color: #ccc;">|</span>
            <a href="/logout" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #e74c3c; transition: all 0.3s;">ğŸšª ×™×¦×™××”</a>
        </nav>

        <!-- Daily Tip -->
        {% if daily_tip %}
        <div class="daily-tip">
            <div class="tip-header">ğŸ’¡ ×˜×™×¤ ×”×™×•× - {{ daily_tip.category }}</div>
            <div class="tip-content">{{ daily_tip.tip }}</div>
        </div>
        {% endif %}

        <h1>ğŸ’° × ×™×”×•×œ ×ª×§×¦×™×‘</h1>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Budget Overview Card -->
        <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); margin-bottom: 30px;">
            <h2 style="margin-top: 0; color: #667eea; display: flex; align-items: center; gap: 10px;">
                ğŸ“Š ×¡×™×›×•× ×ª×§×¦×™×‘
            </h2>

            {% if budget_limit > 0 %}
                <!-- Budget Set -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                    <!-- Total Spent -->
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, {% if is_over_budget %}#f093fb 0%, #f5576c 100%{% else %}#4facfe 0%, #00f2fe 100%{% endif %}); border-radius: 12px; color: white;">
                        <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">×”×•×¦××ª ×¢×“ ×›×”</p>
                        <h2 style="margin: 10px 0; font-size: 2em;">â‚ª{{ "{:,.0f}".format(total) }}</h2>
                    </div>

                    <!-- Budget Limit -->
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
                        <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">×ª×§×¦×™×‘ ×›×•×œ×œ</p>
                        <h2 style="margin: 10px 0; font-size: 2em;">â‚ª{{ "{:,.0f}".format(budget_limit) }}</h2>
                    </div>

                    <!-- Remaining -->
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, {% if is_over_budget %}#ff6b6b 0%, #c92a2a 100%{% else %}#51cf66 0%, #37b24d 100%{% endif %}); border-radius: 12px; color: white;">
                        <p style="margin: 0; font-size: 0.9em; opacity: 0.9;">{% if is_over_budget %}×—×¨×™×’×”{% else %}× ×•×ª×¨{% endif %}</p>
                        <h2 style="margin: 10px 0; font-size: 2em;">â‚ª{{ "{:,.0f}".format(remaining|abs) }}</h2>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 0.95em; color: #666;">
                        <span style="font-weight: bold;">{{ budget_percentage }}% ××”×ª×§×¦×™×‘</span>
                        <span>â‚ª{{ "{:,.0f}".format(total) }} / â‚ª{{ "{:,.0f}".format(budget_limit) }}</span>
                    </div>
                    <div style="background: #e9ecef; height: 30px; border-radius: 15px; overflow: hidden; position: relative;">
                        <div style="background: {% if is_over_budget %}linear-gradient(90deg, #f093fb 0%, #f5576c 100%){% elif budget_percentage > 80 %}linear-gradient(90deg, #ffd93d 0%, #ff6b6b 100%){% else %}linear-gradient(90deg, #51cf66 0%, #37b24d 100%){% endif %}; height: 100%; width: {{ budget_percentage }}%; transition: width 0.5s ease; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.9em;">
                            {% if budget_percentage > 10 %}{{ budget_percentage }}%{% endif %}
                        </div>
                    </div>
                </div>

                <!-- Alert Messages -->
                {% if is_over_budget %}
                <div style="background: linear-gradient(135deg, #ff6b6b 0%, #c92a2a 100%); color: white; padding: 20px; border-radius: 12px; border-right: 5px solid #a61e1e; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 2.5em;">âš ï¸</div>
                        <div>
                            <h3 style="margin: 0 0 8px 0; font-size: 1.3em;">××–×”×¨×”: ×—×¨×™×’×” ××”×ª×§×¦×™×‘!</h3>
                            <p style="margin: 0; font-size: 0.95em;">×—×¨×’×ª ××”×ª×§×¦×™×‘ ×”××ª×•×›× ×Ÿ ×‘-â‚ª{{ "{:,.0f}".format(total - budget_limit) }}. ××•××œ×¥ ×œ×‘×“×•×§ ××ª ×”×”×•×¦××•×ª ×•×œ×©×§×•×œ ×”×ª×××ª ×”×ª×§×¦×™×‘.</p>
                        </div>
                    </div>
                </div>
                {% elif budget_percentage >= 80 %}
                <div style="background: linear-gradient(135deg, #ffd93d 0%, #ff6b6b 100%); color: white; padding: 20px; border-radius: 12px; border-right: 5px solid #f76707; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 2.5em;">âš¡</div>
                        <div>
                            <h3 style="margin: 0 0 8px 0; font-size: 1.3em;">×©×™× ×œ×‘: ××ª×§×¨×‘ ×œ×’×‘×•×œ ×”×ª×§×¦×™×‘</h3>
                            <p style="margin: 0; font-size: 0.95em;">×”×’×¢×ª ×œ-{{ budget_percentage }}% ××”×ª×§×¦×™×‘. × ×•×ª×¨×• â‚ª{{ "{:,.0f}".format(remaining) }} ×œ×”×•×¦××•×ª × ×•×¡×¤×•×ª.</p>
                        </div>
                    </div>
                </div>
                {% endif %}

            {% else %}
                <!-- No Budget Set -->
                <div style="text-align: center; padding: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white; margin-bottom: 25px;">
                    <div style="font-size: 4em; margin-bottom: 15px;">ğŸ’°</div>
                    <h2 style="margin: 0 0 15px 0;">×œ× ×”×•×’×“×¨ ×ª×§×¦×™×‘ ×›×•×œ×œ</h2>
                    <p style="margin: 0 0 20px 0; font-size: 1.1em; opacity: 0.9;">×”×•×¦××ª ×¢×“ ×›×”: â‚ª{{ "{:,.0f}".format(total) }}</p>
                    <a href="/settings" style="display: inline-block; background: white; color: #667eea; padding: 12px 30px; border-radius: 25px; text-decoration: none; font-weight: bold; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        âš™ï¸ ×”×’×“×¨ ×ª×§×¦×™×‘ ×›×•×œ×œ
                    </a>
                </div>
            {% endif %}
        </div>

        <!-- Add Expense Form -->
        <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px;">
            <h2 style="margin-top: 0; color: #667eea;">â• ×”×•×¡×¤×ª ×”×•×¦××” ×—×“×©×”</h2>
            <form action="/budget/add" method="post" style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 15px; align-items: end;">
                <div>
                    <label style="display: block; margin-bottom: 8px; color: #666; font-size: 0.9em;">×ª×™××•×¨ ×”×”×•×¦××”</label>
                    <input type="text" name="description" placeholder="×œ×“×•×’××”: ×ª×©×œ×•× ×œ×¦×œ×" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 8px; color: #666; font-size: 0.9em;">×¡×›×•× (â‚ª)</label>
                    <input type="number" name="amount" placeholder="0.00" step="0.01" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1em;">
                </div>
                <button type="submit" style="padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                    â• ×”×•×¡×£
                </button>
            </form>
        </div>

        <!-- Expenses List -->
        <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
            <h2 style="margin-top: 0; color: #667eea;">ğŸ“‹ ×¨×©×™××ª ×”×•×¦××•×ª</h2>
            
            {% if expenses %}
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 8px;">
                            <th style="padding: 15px; text-align: right; font-weight: bold; color: #333;">#</th>
                            <th style="padding: 15px; text-align: right; font-weight: bold; color: #333;">×ª×™××•×¨</th>
                            <th style="padding: 15px; text-align: left; font-weight: bold; color: #333;">×¡×›×•×</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for expense in expenses %}
                        <tr style="border-bottom: 1px solid #f0f0f0; transition: background 0.2s;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='white'">
                            <td style="padding: 15px; color: #999;">{{ loop.index }}</td>
                            <td style="padding: 15px; color: #333;">{{ expense.description }}</td>
                            <td style="padding: 15px; text-align: left; font-weight: bold; color: #667eea; font-size: 1.1em;">â‚ª{{ "{:,.2f}".format(expense.amount) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; font-weight: bold;">
                            <td style="padding: 15px;" colspan="2">×¡×”"×›</td>
                            <td style="padding: 15px; text-align: left; font-size: 1.3em;">â‚ª{{ "{:,.2f}".format(total) }}</td>
                        </tr>
                    </tfoot>
                </table>
            {% else %}
                <div class="empty-message" style="text-align: center; padding: 60px 20px; color: #999;">
                    <p style="font-size: 4em; margin: 0 0 20px 0;">ğŸ“­</p>
                    <p style="font-size: 1.2em; margin: 0;">××™×Ÿ ×”×•×¦××•×ª ×¢×“×™×™×Ÿ</p>
                    <p style="margin: 10px 0 0 0; color: #bbb;">×”×•×¡×£ ××ª ×”×”×•×¦××” ×”×¨××©×•× ×” ×©×œ×š ×œ××¢×œ×” â†‘</p>
                </div>
            {% endif %}
        </div>

    </div>
</body>
</html>