<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×œ×•×— ×©× ×” ×•××™×¨×•×¢×™×</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .calendar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }
        .calendar-header h3 {
            margin: 0;
            color: #667eea;
        }
        .calendar-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .calendar-nav a {
            padding: 8px 15px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .calendar-nav a:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .view-toggle a {
            padding: 10px 20px;
            background: #e9ecef;
            color: #333;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-weight: 500;
        }
        .view-toggle a.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 10px;
            background: #667eea;
            color: white;
            border-radius: 8px;
            font-size: 0.9em;
        }
        .calendar-day {
            text-align: center;
            padding: 15px 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            min-height: 80px;
            background: white;
            position: relative;
            transition: all 0.2s;
            cursor: pointer;
        }
        .calendar-day:hover {
            background: #f8f9fa;
            border-color: #667eea;
            transform: translateY(-2px);
        }
        .calendar-day.has-event {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: bold;
            border-color: #667eea;
        }
        .calendar-day.today {
            border: 3px solid #f093fb;
            box-shadow: 0 0 10px rgba(240, 147, 251, 0.3);
        }
        .calendar-day-number {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .calendar-day-events {
            font-size: 0.75em;
            margin-top: 5px;
        }
        .event-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            background: #f093fb;
            border-radius: 50%;
            margin: 0 2px;
        }
        
        /* Week View */
        .week-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .week-day {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            min-height: 200px;
        }
        .week-day.today {
            border-color: #f093fb;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        .week-day-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        .week-day-date {
            font-size: 0.85em;
            color: #666;
        }
        .week-event {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 0.85em;
        }
        .week-event-time {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        .events-list {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .event-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .event-info h4 {
            margin: 0 0 5px 0;
        }
        .event-info p {
            margin: 0;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation Menu -->
        <nav style="background: rgba(255,255,255,0.95); padding: 15px; border-radius: 12px; margin-bottom: 20px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
            <a href="/" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; transition: all 0.3s;">ğŸ  ×“×£ ×”×‘×™×ª</a>
            <span style="color: #ccc;">|</span>
            <a href="/tasks" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; transition: all 0.3s;">ğŸ“‹ ××©×™××•×ª</a>
            <span style="color: #ccc;">|</span>
            <a href="/budget" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; transition: all 0.3s;">ğŸ’° ×”×•×¦××•×ª</a>
            <span style="color: #ccc;">|</span>
            <a href="/suppliers" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; transition: all 0.3s;">ğŸ¢ ×¡×¤×§×™×</a>
            <span style="color: #ccc;">|</span>
            <a href="/events" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; font-weight: bold; transition: all 0.3s;">ğŸ“… ××™×¨×•×¢×™×</a>
            <span style="color: #ccc;">|</span>
            <a href="/settings" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #667eea; transition: all 0.3s;">âš™ï¸ ×”×’×“×¨×•×ª</a>
            <span style="color: #ccc;">|</span>
            <a href="/logout" style="margin: 0 15px; font-size: 1.1rem; text-decoration: none; color: #e74c3c; transition: all 0.3s;">ğŸšª ×™×¦×™××”</a>
        </nav>

        <!-- Daily Tip -->
        {% if daily_tip %}
        <div class="daily-tip">
            <div class="tip-header">ğŸ’¡ ×˜×™×¤ ×”×™×•× - {{ daily_tip.category }}</div>
            <div class="tip-content">{{ daily_tip.tip }}</div>
        </div>
        {% endif %}

        <h1>ğŸ“… ×œ×•×— ×©× ×” ×•××™×¨×•×¢×™×</h1>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Add Event Form -->
        <div style="background: white; padding: 25px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px;">
            <h2 style="margin-top: 0; color: #667eea;">â• ×”×•×¡×¤×ª ××™×¨×•×¢ ×—×“×©</h2>
            <form action="/events/add" method="post">
                <input type="text" name="title" placeholder="×©× ×”××™×¨×•×¢" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; margin-bottom: 15px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #666; font-size: 0.9em;">×ª××¨×™×š</label>
                        <input type="date" name="event_date" required style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; direction: ltr;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; color: #666; font-size: 0.9em;">×©×¢×” (××•×¤×¦×™×•× ×œ×™)</label>
                        <input type="time" name="event_time" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; direction: ltr;">
                    </div>
                </div>
                <textarea name="description" placeholder="×ª×™××•×¨ (××•×¤×¦×™×•× ×œ×™)" rows="3" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px; margin-bottom: 15px;"></textarea>
                <button type="submit" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer;">â• ×”×•×¡×£ ××™×¨×•×¢</button>
            </form>
        </div>

        <!-- View Toggle -->
        <div class="view-toggle">
            <a href="/events?view=month&year={{ year }}&month={{ month }}" class="{% if view_type == 'month' %}active{% endif %}">ğŸ“… ×ª×¦×•×’×ª ×—×•×“×©</a>
            <a href="/events?view=week" class="{% if view_type == 'week' %}active{% endif %}">ğŸ“† ×ª×¦×•×’×ª ×©×‘×•×¢</a>
        </div>

        <!-- Calendar -->
        <div class="calendar">
            <div class="calendar-header">
                <div class="calendar-nav">
                    <a href="/events?view={{ view_type }}&year={{ prev_year }}&month={{ prev_month }}">â—€ ×§×•×“×</a>
                </div>
                <h3>ğŸ—“ï¸ {{ month_name }} {{ year }}</h3>
                <div class="calendar-nav">
                    <a href="/events?view={{ view_type }}&year={{ next_year }}&month={{ next_month }}">×”×‘× â–¶</a>
                </div>
            </div>
            
            {% if view_type == 'month' %}
                <!-- Month View -->
                <div class="calendar-grid">
                    <!-- Day Headers -->
                    <div class="calendar-day-header">×¨××©×•×Ÿ</div>
                    <div class="calendar-day-header">×©× ×™</div>
                    <div class="calendar-day-header">×©×œ×™×©×™</div>
                    <div class="calendar-day-header">×¨×‘×™×¢×™</div>
                    <div class="calendar-day-header">×—××™×©×™</div>
                    <div class="calendar-day-header">×©×™×©×™</div>
                    <div class="calendar-day-header">×©×‘×ª</div>
                    
                    <!-- Calendar Days -->
                    {% for week in calendar_days %}
                        {% for day in week %}
                            {% if day.day %}
                                <div class="calendar-day {% if day.has_event %}has-event{% endif %} {% if day.is_today %}today{% endif %}" title="{% if day.events %}{% for event in day.events %}{{ event.title }}{% if event.time %} - {{ event.time }}{% endif %}{% if not loop.last %}, {% endif %}{% endfor %}{% endif %}">
                                    <div class="calendar-day-number">{{ day.day }}</div>
                                    {% if day.events %}
                                        <div class="calendar-day-events">
                                            {% for event in day.events %}
                                                <div style="font-size: 0.7em; margin: 2px 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                                    {% if event.time %}â° {{ event.time }} {% endif %}{{ event.title }}
                                                </div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            {% else %}
                                <div class="calendar-day" style="background: #f8f9fa; border: none;"></div>
                            {% endif %}
                        {% endfor %}
                    {% endfor %}
                </div>
            
            {% elif view_type == 'week' %}
                <!-- Week View -->
                <div class="week-view">
                    {% for day in week_dates %}
                        <div class="week-day {% if day.is_today %}today{% endif %}">
                            <div class="week-day-header">
                                <div>{{ day.day_name }}</div>
                                <div class="week-day-date">{{ day.date.strftime('%d/%m') }}</div>
                            </div>
                            {% if day.events %}
                                {% for event in day.events %}
                                    <div class="week-event">
                                        {% if event.time %}
                                            <div class="week-event-time">â° {{ event.time }}</div>
                                        {% endif %}
                                        <div>{{ event.title }}</div>
                                        {% if event.description %}
                                            <div style="font-size: 0.9em; margin-top: 3px; opacity: 0.9;">{{ event.description[:50] }}{% if event.description|length > 50 %}...{% endif %}</div>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div style="text-align: center; padding: 20px; color: #999; font-size: 0.9em;">××™×Ÿ ××™×¨×•×¢×™×</div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <!-- Events List -->
        <div class="events-list">
            <h2 style="margin-top: 0; color: #667eea;">ğŸ“‹ ×›×œ ×”××™×¨×•×¢×™×</h2>
            {% if events %}
                {% for event in events %}
                <div class="event-item">
                    <div class="event-info">
                        <h4>{{ event.title }}</h4>
                        <p style="margin: 5px 0;">ğŸ“… ×ª××¨×™×š: {{ event.event_date }}</p>
                        {% if event.event_time %}
                        <p style="margin: 5px 0;">â° ×©×¢×”: <span style="unicode-bidi: embed; direction: ltr;">{{ event.event_time }}</span></p>
                        {% endif %}
                        {% if event.description %}
                        <p style="margin-top: 8px;">{{ event.description }}</p>
                        {% endif %}
                    </div>
                    <form action="/events/delete/{{ event.id }}" method="post" style="display: inline;">
                        <button type="submit" style="background: rgba(255,255,255,0.2); border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; color: white; transition: all 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.3)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">ğŸ—‘ï¸ ××—×§</button>
                    </form>
                </div>
                {% endfor %}
            {% else %}
                <div class="empty-message" style="text-align: center; padding: 60px 20px; color: #999;">
                    <p style="font-size: 4em; margin: 0 0 20px 0;">ğŸ“­</p>
                    <p style="font-size: 1.2em; margin: 0;">××™×Ÿ ××™×¨×•×¢×™× ×¢×“×™×™×Ÿ</p>
                    <p style="margin: 10px 0 0 0; color: #bbb;">×”×•×¡×£ ××ª ×”××™×¨×•×¢ ×”×¨××©×•×Ÿ ×©×œ×š ×œ××¢×œ×” â†‘</p>
                </div>
            {% endif %}
        </div>
    </div>
</body>
</html>